<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Image Translate</title>
    <!-- AWS SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1691.0.min.js"></script>
    <!-- Simple CSS framework for clean UI -->
    <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css" rel="stylesheet">
    <!-- Custom styles -->
    <link href="css/styles.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1>AWS Image Translate</h1>
        <p>Upload images to detect and translate text using AWS services</p>

        <div class="drop-zone" id="dropZone">
            <p>Drop images here or click to select</p>
            <input type="file" id="fileInput" multiple accept="image/*" style="display: none">
        </div>

        <ul class="upload-list" id="uploadList">
            <!-- Upload items will be added here -->
        </ul>

        <button id="processBtn" style="display: none">Process All Images</button>

        <div class="results" id="results" style="display: none">
            <!-- Results will be displayed here -->
        </div>
    </div>

    <script>
        // Initialize AWS SDK
        AWS.config.region = 'us-east-1'; // Replace with your region
        const s3 = new AWS.S3();

        // UI Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadList = document.getElementById('uploadList');
        const processBtn = document.getElementById('processBtn');
        const resultsDiv = document.getElementById('results');

        // Track uploads
        let uploadQueue = [];

        // Drag and drop handlers
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            for (const file of files) {
                if (file.type.startsWith('image/')) {
                    addToUploadQueue(file);
                }
            }
            if (uploadQueue.length > 0) {
                processBtn.style.display = 'block';
            }
        }

        function addToUploadQueue(file) {
            const item = {
                file,
                id: `upload-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`, // NOSONAR
                status: 'pending'
            };

            uploadQueue.push(item);

            const li = document.createElement('li');
            li.className = 'upload-item';
            li.id = item.id;

            // Create thumbnail
            const reader = new FileReader();
            reader.onload = (e) => {
                li.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <div class="details">
                        <div>${file.name}</div>
                        <div class="progress">
                            <div class="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="status">Pending</div>
                `;
            };
            reader.readAsDataURL(file);

            uploadList.appendChild(li);
        }

        processBtn.addEventListener('click', async () => {
            processBtn.disabled = true;

            for (const item of uploadQueue) {
                if (item.status === 'pending') {
                    await uploadAndProcess(item);
                }
            }

            resultsDiv.style.display = 'block';
        });

        async function uploadAndProcess(item) {
            const li = document.getElementById(item.id);
            const statusDiv = li.querySelector('.status');
            const progressBar = li.querySelector('.progress-bar');

            try {
                // Update status to uploading
                statusDiv.textContent = 'Uploading...';

                // Upload to S3
                const params = {
                    Bucket: 'YOUR_S3_BUCKET',
                    Key: `uploads/${item.file.name}`,
                    Body: item.file,
                    ContentType: item.file.type
                };

                const upload = s3.upload(params);

                upload.on('httpUploadProgress', (progress) => {
                    const percentage = (progress.loaded / progress.total * 100).toFixed(0);
                    progressBar.style.width = `${percentage}%`;
                });

                await upload.promise();

                // Update status to processing
                statusDiv.textContent = 'Processing...';

                // Here we would call our AWS Lambda function to process the image
                // For now, we'll simulate the process
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Update status to complete
                statusDiv.textContent = 'Complete';
                item.status = 'complete';

                // Add result to results div
                const result = document.createElement('div');
                result.innerHTML = `
                    <h3>${item.file.name}</h3>
                    <p>Detected Text: Sample text detected</p>
                    <p>Translation: Sample translation</p>
                    <hr>
                `;
                resultsDiv.appendChild(result);

            } catch (error) {
                statusDiv.textContent = 'Error';
                console.error('Error processing file:', error);
                item.status = 'error';
            }
        }
    </script>
</body>

</html>